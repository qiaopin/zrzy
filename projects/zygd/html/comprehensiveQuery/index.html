<!DOCTYPE html>
<html xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>综合查询</title>
    <link rel="stylesheet" type="text/css" href="../../js/layui-v2.4.5/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="../../js/layer/theme/default/layer.css"/>
    <link rel="stylesheet" type="text/css" href="../../js/openlayers/ol.css"/>
    <link rel="stylesheet" type="text/css" href="index.css"/>
    <style>
        .bottomTtnBox {
            padding-top: 10px;
            position: fixed;
            bottom: 0px;
            width: 380px;
            background: #fff;
            text-align: center;
        }

        .topQuery > form {
            display: none;
        }
    </style>
</head>

<body class="white">
<div class="changeZX">
    <form class="layui-form">
        <div class="layui-form-item">
            <label class="layui-form-label">选择专项</label>
            <div class="layui-input-inline">
                <select id="zx" name="zx" lay-filter="zx">
                    <option value="wphc">卫片核查</option>
                    <option value="gdjf">耕地建房</option>
                    <option value="phjg">批后监管</option>
                </select>
            </div>
        </div>
    </form>
</div>
<div class="topQuery">
    <form class="layui-form wphc" style="display: block">
        <div class="layui-form-item others">
            <label class="layui-form-label">调查人</label>
            <div class="layui-input-inline">
                <input type="text" name="dcr" placeholder="调查人" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item item-line">
            <div class="layui-inline">
                <label class="layui-form-label">调查时间</label>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="text" id="wpdcsj_min" name="dcsj_min" placeholder="年-月-日" autocomplete="off"
                           class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="text" id="wpdcsj_max" name="dcsj_max" placeholder="年-月-日" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item bottomTtnBox">
            <div class="layui-inline">
                <div id="wpreSearch" class="layui-btn layui-btn-warm" lay-submit lay-filter="reSearch">
                    <i class="layui-icon">&#xe669;</i>重置
                </div>
            </div>
            <div class="layui-inline">
                <div id="wpsearch" class="layui-btn layui-btn-normal" lay-submit lay-filter="search">
                    <i class="layui-icon">&#xe615;</i>查询
                </div>
            </div>
            <div class="layui-inline">
                <div id="wpfx" class="layui-btn layui-btn-danger" lay-submit lay-filter="search">
                    <i class="layui-icon">&#xe615;</i>分析
                </div>
            </div>
        </div>
    </form>
    <form class="layui-form gdjf">
        <div class="layui-form-item item-line xzqArea">
            <div class="layui-input-inline layui-hide">
                <select id="city" name="city" lay-filter="city" disabled="disabled">
                    <option value="">请选择市</option>
                </select>
            </div>
            <div class="layui-input-inline layui-hide">
                <select id="area" name="area" lay-filter="area" disabled="disabled">
                    <option value="">请选择县/区</option>
                </select>
            </div>
            <div class="layui-input-inline">
                <select id="xzmc" name="xzmc" lay-filter="xzmc">
                    <option value="">请选择乡镇</option>
                </select>
            </div>
            <div class="layui-input-inline">
                <select id="cmc" name="cmc" lay-filter="cmc">
                    <option value="">请选择村</option>
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">作业状态</label>
            <div class="layui-input-inline">
                <select id="shzt" name="shzt" lay-filter="shzt">
                    <option value="">全部</option>
                    <option value="3">作业中</option>
                    <option value="4">提交到县</option>
                    <option value="5">提交到市</option>
                    <option value="6">提交到省</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item item-line tjsjBox">
            <div class="layui-inline">
                <label class="layui-form-label">提交时间</label>
                <div class="layui-input-inline" style="width: 200px;">
                    <input type="text" id="tjsjmin" name="tjsjmin" placeholder="" autocomplete="off"
                           class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 200px;margin-left: 155px;">
                    <input type="text" id="tjsjmax" name="tjsjmax" placeholder="" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item others">
            <label class="layui-form-label">调查人</label>
            <div class="layui-input-inline">
                <input type="text" name="dcr" placeholder="调查人" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item item-line">
            <div class="layui-inline">
                <label class="layui-form-label">调查时间</label>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="text" id="dcsj_min" name="dcsj_min" placeholder="年-月-日" autocomplete="off"
                           class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="text" id="dcsj_max" name="dcsj_max" placeholder="年-月-日" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item others">
            <label class="layui-form-label">房屋性质</label>
            <div class="layui-input-inline">
                <select id="fwxz" name="fwxz" lay-filter="fwxz">
                    <option value="">全部</option>
                    <option value="居住用房">居住用房</option>
                    <option value="工矿厂房">工矿厂房</option>
                    <option value="经营用房">经营用房</option>
                    <option value="设施农业用房">设施农业用房</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item others">
            <label class="layui-form-label">房屋位置</label>
            <div class="layui-input-inline">
                <select id="fwwz" name="fwwz" lay-filter="fwwz">
                    <option value="">全部</option>
                    <option value="村庄周围">村庄周围</option>
                    <option value="公路两侧">公路两侧</option>
                    <option value="城市郊区">城市郊区</option>
                    <option value="农田中">农田中</option>
                    <option value="其他">其他</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item others">
            <div class="layui-inline">
                <label class="layui-form-label">是否有手续</label>
                <div class="layui-input-inline">
                    <select name="sfysx" lay-filter="sfysx">
                        <option value="">全部</option>
                        <option value="是">是</option>
                        <option value="否">否</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item others">
            <div class="layui-inline">
                <label class="layui-form-label">建设状态</label>
                <div class="layui-input-inline">
                    <select name="jszt" lay-filter="">
                        <option value="">全部</option>
                        <option value="建成">建成</option>
                        <option value="在建">在建</option>
                        <option value="闲置">闲置</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline fwsyfs">
                <label class="layui-form-label">房屋使用方式</label>
                <div class="layui-input-inline">
                    <select name="fwsyfs" lay-filter="fwsyfs">
                        <option value="">全部</option>
                        <option value="自住">自住</option>
                        <option value="销售">销售</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline fhtj">
                <label class="layui-form-label">是否符合"一户一宅"</label>
                <div class="layui-input-inline">
                    <select id="sffhtj" name="sffhtj" lay-filter="">
                        <option value="">全部</option>
                        <option value="是">是</option>
                        <option value="否">否</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <!--<label class="layui-form-label">时间条件</label>-->
            <div class="layui-inline">
                <label class="layui-form-label">建房时间</label>
                <div class="layui-input-inline" style="width: 90px;">
                    <input id="jfsj_min" type="text" name="jfsj_min" placeholder="" autocomplete="off"
                           class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 90px;">
                    <input id="jfsj_max" name="jfsj_max" type="text" placeholder="" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-inline spsj">
                <label class="layui-form-label">手续审批时间</label>
                <div class="layui-input-inline" style="width: 90px;">
                    <input id="spsj_min" type="text" name="spsj_min" placeholder="年" autocomplete="off"
                           class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 90px;">
                    <input id="spsj_max" type="text" name="spsj_max" placeholder="年" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item item-line">
            <div class="layui-inline">
                <label class="layui-form-label">建筑面积</label>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="number" name="jzmj_min" placeholder="㎡" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="number" name="jzmj_max" placeholder="㎡" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">占用耕地总面积</label>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="number" name="zygdzmj_min" placeholder="亩" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="number" name="zygdzmj_max" placeholder="亩" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">占用基本农田面积</label>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="number" name="zyjbnt_min" placeholder="亩" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="number" name="zyjbnt_max" placeholder="亩" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">占用一般耕地面积</label>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="number" name="zyybgd_min" placeholder="亩" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 90px;">
                    <input type="number" name="zyybgd_max" placeholder="亩" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item bottomTtnBox">
            <div class="layui-inline">
                <div id="reSearch" class="layui-btn layui-btn-warm" lay-submit lay-filter="reSearch">
                    <i class="layui-icon">&#xe669;</i>重置
                </div>
            </div>
            <div class="layui-inline">
                <div id="search" class="layui-btn layui-btn-normal" lay-submit lay-filter="search">
                    <i class="layui-icon">&#xe615;</i>查询
                </div>
            </div>
            <div class="layui-inline">
                <div id="fx" class="layui-btn layui-btn-danger" lay-submit lay-filter="search">
                    <i class="layui-icon">&#xe615;</i>分析
                </div>
            </div>
        </div>
    </form>
    <form class="layui-form phjg">
        <div class="layui-form-item item-line">
            <div class="layui-inline">
                <label class="layui-form-label">批地时间</label>
                <div class="layui-input-inline" style="width: 200px;">
                    <input type="text" id="pdsjmin" name="tjsjmin" placeholder="" autocomplete="off"
                           class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 200px;margin-left: 155px;">
                    <input type="text" id="pdsjmax" name="tjsjmax" placeholder="" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item bottomTtnBox">
            <div class="layui-inline">
                <div id="pdreSearch" class="layui-btn layui-btn-warm" lay-submit lay-filter="reSearch">
                    <i class="layui-icon">&#xe669;</i>重置
                </div>
            </div>
            <div class="layui-inline">
                <div id="pdsearch" class="layui-btn layui-btn-normal" lay-submit lay-filter="search">
                    <i class="layui-icon">&#xe615;</i>查询
                </div>
            </div>
            <div class="layui-inline">
                <div id="pdfx" class="layui-btn layui-btn-danger" lay-submit lay-filter="search">
                    <i class="layui-icon">&#xe615;</i>分析
                </div>
            </div>
        </div>
    </form>


</div>
<div class="top">
    <div id="map">

    </div>
    <div class="mouseTitle">鼠标提示</div>
</div>
<div class="bottom">
    <div class="title_div">
        <span id="searchAttr"></span>
        <span class="f-right">
            <button id="export" type="button" class="layui-btn layui-btn-xs layui-btn-normal">导出</button>
        </span>
    </div>
    <div class="niceScroll table1_div">
        <table id="table1" lay-filter="table1"></table>
        <div id="laypage"></div>
    </div>
</div>

</body>
<script src="../../js/jquery-2.1.0.js"></script>
<script src="../../js/config.js"></script>
<script src="../../js/common.js"></script>
<script src="../../js/scrollbar/jquery.nicescroll.min.js"></script>
<script src="../../js/layer/layer.js"></script>
<script src="../../js/layui/layui.js"></script>
<script src="../../js/modules/layui-config.js"></script>
<script src="../../js/openlayers/ol-debug.js"></script>
<script src="../../js/openlayers/maptool.js"></script>
<script>
    var ljfBase = null;
    var slider = null;
    var form = null;
    var layerManager = null;
    var _mapObject = null;
    var _mapView = null;
    var layuitable = null;
    var laypage = null;
    var activationClick = null;
    var cityData;
    var searchData;
    var exportIndex;//选择导出列页面
    //分页
    var pageIndex = 1;//当前是第几页
    var pageNum = 100;//一页几条数据
    var count = 0;//数据总条数
    // var layer;
    var isExport;//是否执行导出

    parent.JFZD = JSON.parse(sessionStorage.JFZD)[0];
    sessionStorage.userXZQDM = parent.JFZD.XZQDM;

    var loading;
    $(".mouseTitle").hide();
    $(document).ready(function () {
        $(document).bind('mousemove', function (ev) {
            var lastx = ev.pageX - $(".top").offset().left + 10;
            var lasty = ev.pageY;
            $(".mouseTitle").css("left", lastx + "px");
            $(".mouseTitle").css("top", lasty + "px");
        })
    });

    layui.use(['form', 'element', 'laydate', 'table', 'laypage', 'slider', 'ljfBase', 'serverCenter', 'LayerManager', 'NULayer', 'bluebird'], function () {
        form = layui.form;
        layuitable = layui.table;
        laypage = layui.laypage;
        slider = layui.slider;
        var layuidate = layui.laydate;
        // layer = layui.layer;
        layuidate.render({
            elem: '#jfsj_min'
            // , type: 'year'
        });
        layuidate.render({
            elem: '#jfsj_max'
            // , type: 'year'
        });
        layuidate.render({
            elem: '#spsj_min'
            , type: 'year'
        });
        layuidate.render({
            elem: '#spsj_max'
            , type: 'year'
        });

        layuidate.render({
            elem: '#dcsj_min'
        });
        layuidate.render({
            elem: '#tjsjmin',
            format: 'yyyy-MM-dd HH:mm:ss'
            , type: 'datetime'
        });

        layuidate.render({
            elem: '#tjsjmax',
            format: 'yyyy-MM-dd HH:mm:ss'
            , type: 'datetime'
        });

        ljfBase = layui.ljfBase;
        var LayerManager = layui.LayerManager;
        var center = [114.48, 38.03];
        layerManager = new LayerManager("map", center, 12);
        _mapObject = layerManager._mapObject;
        showBJByUserXZQ(layerManager._mapObject);
        ljfBase.post(ljfBase.https.BaseMapManagerService + "/GetAllBaseMap", {sprid: sessionStorage.sprid}, function (xml) {
            var resArr = $.parseJSON(xml);
            if (resArr.length == 0) {
                location.reload();
            }
            layerManager.loadBaseMap(resArr, "矢量");
            $('.maptab ul li').click(function () {
                $('.maptab ul li').removeClass("active");
                $(this).addClass("active");
                var type = $(this).find('a').attr('type');
                layerManager.hideBaseMap();
                layerManager.loadBaseMap(resArr, type);
            });
        });
        initMapQuery();
        addPointZB();
        init();

        form.on('select(zx)', function (res) {//切换专项
            var zx = res.value;
            top.zx = zx;
            $(".topQuery>.layui-form").hide();
            $(".layui-form." + zx).show();
        });

        // form.on('select(city)', function (res) {//切换市
        //     var shiValue = res.value;
        //     var smc = $("#city option:selected").text();
        //     showCityZB(smc);
        //     getXianList(shiValue);
        // });

        // form.on('select(area)', function (res) {//切换县
        //     var xzqdm = res.value;
        //     var smc = $("#city option:selected").text();
        //     var xmc = $("#area option:selected").text();
        //     showAreaZB(smc,xmc);
        //     getXZListByDM(xzqdm);
        // });

        form.on('select(xzmc)', function (res) {//切换乡镇
            var xzqdm = $("#area").val();
            var xzmc = res.value;
            getCList(xzqdm, xzmc);
        });

        form.on('select(shzt)', function (res) {//切换作业状态
            var shzt = res.value;
            if (shzt && Number(shzt) > 3) {
                $(".tjsjBox").show();
            } else {
                $(".tjsjBox").hide();
                $("#tjsjmin").val("");
                $("#tjsjmax").val("");
            }
            form.render();
        });

        form.on('select(fwxz)', function (res) {//切换房屋性质
            if (res.value != "居住用房" && res.value != "") {
                $(".fwsyfs").hide();
                $("#fwsyfs").val("");
                $(".fhtj").hide();
                $("#sffhtj").val("");
            } else {
                $(".fwsyfs").show();
                $(".fhtj").show();
            }
            form.render();
        });

        form.on('select(sfysx)', function (res) {//切换是否有手续
            if (res.value == "否") {
                $(".spsj").hide();
                $("#spsj_min").val("");
                $("#spsj_max").val("");
            } else {
                $(".spsj").show();
            }
            form.render();
        });

        form.on('select(fwsyfs)', function (res) {//切换房屋使用方式
            if (res.value == "销售") {
                $(".fhtj").hide();
                $("#sffhtj").val("");
            } else {
                $(".fhtj").show();
            }
            form.render();
        });

        form.on("submit(search)", function (data) {
            loading = layer.load(0, {shade: 0.1});
            var data = data.field;
            data.cityName = $("#city").val() == "" ? "" : $("#city option:selected").text();
            data.areaName = $("#area").val() == "" ? "" : $("#area option:selected").text();
            searchData = data;

            if (isExport) {//导出
                layer.close(loading);
                isExport = false;
                exportIndex = layer.open({
                    type: 2,
                    title: false,
                    closeBtn: 0, //不显示关闭按钮
                    shade: [0],
                    skin: 'layui-layer-lan',
                    area: ['930px', '315px'],
                    anim: 2,//弹出动画
                    shade: 0.2,//遮盖层
                    content: ['exportCols.html', 'no'], //这里content是一个普通的String
                });
            } else {//查询
                pageIndex = 1;
                count = 0;
                GetRurallandn();
            }
            return false;
        });
    });

    function init() {//初始化赋值搜索条件
        getCityList();
        if (parent.JFZD.USERTYPE == "省厅负责人") {

        } else if (parent.JFZD.USERTYPE == "市局负责人") {
            var shi = parent.JFZD.XZQ.split(" ")[1];
            $.each(cityData[0].children, function (i, v) {
                if (v.text == shi) {
                    $("#city").html("<option value='" + v.value + "'>" + v.text + "</option>").attr("disabled", true);
                    getXianList(v.value);
                    form.render();
                    return;
                }
            });
        } else if (parent.JFZD.USERTYPE == "县局负责人") {
            var shi = parent.JFZD.XZQ.split(" ")[1];
            var xian = parent.JFZD.XZQ.split(" ")[2];
            var xzqdm = parent.JFZD.XZQDM;
            $.each(cityData[0].children, function (i, v) {
                if (v.text == shi) {
                    $("#city").html("<option value='" + v.value + "'>" + v.text + "</option>").attr("disabled", true);
                    getXianList(v.value);
                    return;
                }
            });
            $('#area').html("<option value='" + xzqdm + "'>" + xian + "</option>").attr("disabled", true);
            getXZListByDM(xzqdm);
            $(".xzqArea").show();
        }
    }

    function getCityList() {
        var getCityUrl = "http://110.249.159.46:8089/gtkjghTest/ConfigManagerService.asmx/GetCityData2";
        $.ajax(getCityUrl, {
            data: {},
            dataType: "text", //返回文本
            jsonp: "jsonp",
            async: false,
            type: 'post', //HTTP请求类型
            timeout: 10000, //超时时间设置为10秒；
            success: function (xml) {
                var resjosn = $(xml).text();
                cityData = JSON.parse(resjosn);
                // debugger
                var str = '<option value="">选择市</option>';
                if (!cityData[0]) {
                    getCityList();
                }
                var list = cityData[0].children;
                $.each(list, function (i, v) {
                    str += '<option value="' + v.value + '">' + v.text + '</option>';
                });
                $("#city").html(str);
                var shiValue = list[0].text;
                getXianList(shiValue);
                form.render();
            },
            error: function (xhr, type, errorThrown) {
                //异常处理；
                console.log(type);
            }
        });
    }

    $("#export").click(function () {
        loading = layer.load(0, {shade: 0.1});
        isExport = true;
        $("#search").click();
    });

    function exportRes(cols) {//开始导出
        layer.closeAll();
        loading = layer.load(0, {shade: 0.1});
        var postData = {
            searchData: searchData,
            cols: cols
        };
        var postStr = JSON.stringify(postData);
        console.log(postStr);
        $.ajax("http://110.249.159.46:8081/zygd/RurallandController/excelFindByCondition", {
            data: postStr,
            dataType: "json", //返回文本
            contentType: "application/json",
            type: 'post', //HTTP请求类型
            // timeout: 100000, //超时时间设置为100秒；
            success: function (res) {
                console.log(res);
                var url = JSON.parse(res).data;
                var code = JSON.parse(res).code;
                if (code == 0 && url) {
                    window.open(url);
                } else {
                    layer.msg(JSON.parse(res).msg);
                }
                layer.close(loading);
            },
            error: function (xhr, type, errorThrown) {
                //异常处理；
                layer.close(loading);
                console.log(type);
            }
        });
    }

    function getXianList(shiValue) {
        var list = cityData[0].children;
        var str = '<option value="">选择区/县</option>';
        if (shiValue) {
            $.each(list, function (i, v) {
                if (v.value == shiValue) {
                    $.each(v.children, function (s, k) {
                        str += '<option value="' + k.value + '">' + k.text + '</option>';
                    });
                    return;
                }
            })
        }
        $("#area").html(str);
        form.render();
        getXZListByDM($("#area").val());
    }

    //获取乡镇列表
    function getXZListByDM(xzqdm) {
        var str = '<option value="">选择乡镇</option>';
        var url = "http://110.249.159.46:8089/gtkjghTest/ConfigManagerService.asmx/GetXZNamesbyXZQDM";
        $.ajax(url, {
            data: {
                xzqdm: xzqdm
            },
            dataType: "text", //返回文本
            jsonp: "jsonp",
            async: false,
            type: 'post', //HTTP请求类型
            timeout: 10000, //超时时间设置为10秒；
            success: function (xml) {
                var resStr = $(xml).text();
                var resArr = JSON.parse(resStr);
                $.each(resArr, function (i, v) {
                    str += '<option value="' + v + '">' + v + '</option>';
                });
                $("#xzmc").html(str);
                form.render();
            },
            error: function (xhr, type, errorThrown) {
                //异常处理；
                console.log(type);
            }
        });
        getCList($("#area").val(), $("#xzmc").val());
    }

    //获取村列表
    function getCList(xzqdm, xzmc) {
        var str = '<option value="">选择村</option>';
        var url = "http://110.249.159.46:8089/gtkjghTest/ConfigManagerService.asmx/GetCMCNamesbyXZQDM";
        $.ajax(url, {
            data: {
                xzqdm: xzqdm,
                xzmc: xzmc
            },
            dataType: "text", //返回文本
            jsonp: "jsonp",
            async: false,
            type: 'post', //HTTP请求类型
            timeout: 10000, //超时时间设置为10秒；
            success: function (xml) {
                var resStr = $(xml).text();
                var resArr = JSON.parse(resStr);
                $.each(resArr, function (i, v) {
                    str += '<option value="' + v + '">' + v + '</option>';
                });
                $("#cmc").html(str);
                form.render();
            },
            error: function (xhr, type, errorThrown) {
                //异常处理；
                console.log(type);
            }
        });
    }

    $("#reSearch").click(function () {//重置
        $(".layui-form input,.layui-form select").val("");
        showBJByUserXZQ(layerManager._mapObject);
        init();
        form.render();
    });

    $(".hiddenOthers").click(function () {
        $(".others").hide();
        $(".hiddenOthers").hide();
        $(".showOthers").attr("style", "display:inline-block;");
    });

    $(".showOthers").click(function () {
        $(".others").show();
        $(".hiddenOthers").attr("style", "display:inline-block;");
        $(".showOthers").hide();
    });

    function GetRurallandn() {
        searchData.pageIndex = pageIndex;
        searchData.pageNum = pageNum;
        var url = "http://110.249.159.46:8081/zygd/RurallandController/findByCondition";
        $.ajax(url, {
            data: JSON.stringify(searchData),
            dataType: "json", //返回文本
            // async: false,
            contentType: "application/json",
            type: 'post', //HTTP请求类型
            // timeout: 10000, //超时时间设置为10秒；
            success: function (xml) {
                var resjosn = JSON.parse(xml);
                var code = resjosn.code;
                if (code == 0) {
                    count = resjosn.count;
                    showTable(resjosn.data);
                } else {
                    layer.alert(resjosn.error);
                }
            },
            error: function (xhr, type, errorThrown) {
                //异常处理；
                layer.alert(type);
                layer.close(loading);
            }
        });
    }

    function showTable(resjosn) {
        var allSearchAttr = [];
        showFWFeature(resjosn);
        var searchXZQ = searchData.cityName + searchData.areaName + searchData.xzmc + searchData.cmc;
        if (searchXZQ) {
            allSearchAttr.push(searchXZQ);
        } else {
            allSearchAttr.push("全省");
        }

        var height = $(".table1_div").height();

        var cols = [{type: 'numbers', title: '序号', width: '80'}];

        if (!searchData.cmc) {
            if (searchData.xzmc) {
                cols.push({
                    title: '行政区', templet: function (d) {
                        return d.csqmc;
                    }, width: 120
                });
            } else {
                if (searchData.areaName) {
                    cols.push({
                        title: '行政区', templet: function (d) {
                            return d.xzmc + d.csqmc;
                        }, width: 120
                    });
                } else {
                    if (searchData.cityName) {
                        cols.push({
                            title: '行政区', templet: function (d) {
                                return d.xmc + d.xzmc + d.csqmc;
                            }, width: 120
                        });
                    }
                }
            }
        }

        cols.push({field: 'fwjsztmc', title: '主体名称', width: 120});

        if (searchData.shzt) {
            var shzt = searchData.shzt;
            var str = "";
            if (shzt < 4) {
                str = "作业中";
            } else if (shzt == 4) {
                str = "提交到县";
            } else if (shzt == 5) {
                str = "提交到市";
            } else if (shzt == 6) {
                str = "提交到省";
            }
            allSearchAttr.push(str);
        } else {
            var obj = {
                field: 'shzt', title: '作业状态', width: 90, templet: function (d) {
                    var str = "";
                    if (d.shzt < 4) {
                        str = "作业中";
                    } else if (d.shzt == 4) {
                        str = "提交到县";
                    } else if (d.shzt == 5) {
                        str = "提交到市";
                    } else if (d.shzt == 6) {
                        str = "提交到省";
                    }
                    return str;
                }
            };
            cols.push(obj);
        }

        if (searchData.dcr) {
            allSearchAttr.push("调查人：" + searchData.dcr);
        } else {
            var obj = {field: 'tbr', title: '调查人', width: 90};
            cols.push(obj);
        }

        if (searchData.fwxz) {
            allSearchAttr.push(searchData.fwxz);
        } else {
            cols.push({field: 'fwxz', title: '房屋性质', width: 110});
        }

        if (searchData.fwwz) {
            allSearchAttr.push(searchData.fwwz);
        } else {
            cols.push({field: 'fwwz', title: '房屋位置', width: 90});
        }

        if (searchData.sfysx) {
            var str = "有手续";
            if (searchData.sfysx == "否") {
                str = "无手续";
            }
            allSearchAttr.push(str);
        } else {
            cols.push({field: 'sfyfbl', title: '是否有手续', width: 110});
        }

        if (searchData.jszt) {
            allSearchAttr.push(searchData.jszt);
        } else {
            cols.push({field: 'jfzt', title: '建设状态', width: 90});
        }

        if (searchData.fwxz == "居住用房" || searchData.fwxz == "") {
            if (searchData.fwsyfs) {
                allSearchAttr.push(searchData.fwsyfs);
            } else {
                cols.push({field: 'fjlr', title: '使用方式', width: 90});
            }

            if (searchData.sffhtj) {
                var str = "符合一户一宅";
                if (searchData.sffhtj == "否") {
                    str = "不符合一户一宅";
                }
                allSearchAttr.push(str);
            } else {
                cols.push({field: 'sffhtj', title: '符合一户一宅', width: 120});
            }
        }

        cols.push({field: 'jzmj', title: '建筑面积', width: 90});
        cols.push({
            field: 'jfsj', title: '建房时间', width: 110, templet: function (d) {
                return d.jfsj.split(" ")[0];
            }
        });

        if (searchData.sfysx != "否") {
            cols.push({
                field: 'pzrq', title: '批准时间', width: 110, templet: function (d) {
                    var str = d.pzrq.split(" ")[0];
                    if (str == "1980-01-01") {
                        str = "";
                    }
                    return str;
                }
            });
        }

        cols.push({field: 'zygdmj', title: '占用耕地总面积', width: 130});
        cols.push({field: 'jbnt', title: '占用基本农田', width: 120});
        cols.push({field: 'ybgd', title: '占用一般耕地', width: 120});
        cols.push({
            field: 'tbrq', title: '调查时间', width: 110, templet: function (d) {
                return d.tbrq.split(" ")[0];
            }
        });

        cols.push({
            title: '操作', align: 'center', width: 120, templet: function (d) {
                var str = "";
                str += '<a class="layui-btn layui-btn-xs layui-btn-skyblue" lay-event="location">定位</a>';
                str += '<a class="layui-btn layui-btn-skyblue layui-btn-xs"  lay-event="look">查看</a>';
                return str
            }
        });
        var attrStr = "";
        $.each(allSearchAttr, function (i, v) {
            attrStr += "<span class='attrItem'>" + v + "</span>";
        });
        $("#searchAttr").html(attrStr);
        layuitable.render({
            elem: '#table1',
            height: height - 60,
            page: false, //开启分页
            limit: resjosn.length,
            // limits: [10, 50, 100],
            cols: [cols],
            data: resjosn,
            done: function () {
                layer.close(loading);
            }
        });
        laypage.render({
            elem: 'laypage'
            , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
            , count: count //数据总数
            , curr: pageIndex
            , limit: pageNum
            , limits: [100, 500, 1000]
            , jump: function (obj, first) {
                console.log(obj);
                if (!first) {
                    pageIndex = obj.curr;
                    pageNum = obj.limit;
                    GetRurallandn();
                }
            }
        });
        layuitable.on('tool(table1)', function (obj) {
            activationClick = null;
            var data = obj.data;
            var el = $(obj.tr).find("a[lay-event='" + obj.event + "']").attr('disabled');
            if (el) {
                return;
            }
            if (obj.event === 'location') {//定位
                var NUSource1 = NUSourceLayer1.getSource();  //获取Source
                NUSource1.clear();
                var FWZB = data.fwzb;
                var lon = FWZB.split(',')[0];
                var lat = FWZB.split(',')[1];
                lon = Number(lon);
                lat = Number(lat);
                _mapView.setCenter([lon, lat]);//单点定位
                _mapView.setZoom(17);//设置级别

                var feature = new ol.Feature(new ol.geom.Point([lon, lat]));
                var Style = new ol.style.Style({
                    image: new ol.style.Icon(({
                        src: "../../images/maplable/blueIcon.png",
                    })),
                });
                feature.setStyle(Style);
                feature.set("FWBH", data.FWBH);
                NUSource1.addFeature(feature);
            } else if (obj.event === 'look') {
                layer.look = true;
                layer.data = {};
                var littleData = data;
                $.each(littleData, function (i, v) {
                    layer.data[i.toUpperCase()] = v;
                });
                layer.openIndex = layer.open({
                    type: 2,
                    title: false,
                    closeBtn: 0, //不显示关闭按钮
                    shade: [0],
                    skin: 'layui-layer-lan',
                    area: ['100%', '100%'],
                    anim: 2,//弹出动画
                    shade: 0.2,//遮盖层
                    content: ['edit.html', 'no'], //这里content是一个普通的String
                });
            }
        });
    }

</script>

</html>
